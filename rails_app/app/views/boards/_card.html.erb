<%
  priority_classes = case card.priority
  when 'low' then 'bg-blue-100 text-blue-700'
  when 'medium' then 'bg-yellow-100 text-yellow-700'
  when 'high' then 'bg-orange-100 text-orange-700'
  when 'urgent' then 'bg-red-100 text-red-700'
  else 'bg-gray-100 text-gray-700'
  end
%>
<div class="kanban-card bg-white rounded-lg shadow-sm p-3 cursor-pointer hover:shadow-md transition-shadow border-l-4 border-<%= card.priority_color %>-500"
     data-card-id="<%= card.id %>"
     data-controller="draggable"
     data-action="click->kanban#showCardDetail"
     draggable="true"
     data-draggable-target="item">
  <h4 class="text-sm font-medium text-gray-900"><%= card.title %></h4>

  <% if card.description.present? %>
    <p class="mt-1 text-xs text-gray-500 line-clamp-2"><%= card.description %></p>
  <% end %>

  <div class="mt-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <!-- Priority Badge -->
      <span class="inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium <%= priority_classes %>">
        <%= card.priority.capitalize %>
      </span>

      <% if card.due_date.present? %>
        <span class="inline-flex items-center gap-1 text-xs <%= card.overdue? ? 'text-red-600' : card.due_soon? ? 'text-orange-600' : 'text-gray-500' %>">
          <svg class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z" clip-rule="evenodd" />
          </svg>
          <%= card.due_date.strftime("%b %d") %>
        </span>
      <% end %>
    </div>

    <!-- Assignees -->
    <% if card.assignees.any? %>
      <div class="flex -space-x-1">
        <% card.assignees.first(3).each do |assignee| %>
          <div class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 text-white text-xs font-medium ring-1 ring-white" title="<%= assignee.name %>">
            <%= assignee.initials %>
          </div>
        <% end %>
        <% if card.assignees.count > 3 %>
          <div class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-200 text-gray-600 text-xs font-medium ring-1 ring-white">
            +<%= card.assignees.count - 3 %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
