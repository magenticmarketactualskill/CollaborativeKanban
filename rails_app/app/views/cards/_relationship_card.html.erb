<%# Individual relationship card
    Accepts: related_card (required), card (required), board (required), relationship_type (required) %>
<div class="flex items-center justify-between bg-white rounded px-2 py-1.5 text-sm">
  <div class="flex items-center gap-2 min-w-0 flex-1">
    <span class="inline-flex items-center justify-center w-5 h-5 rounded text-xs font-medium
      <%= case related_card.priority
          when 'urgent' then 'bg-red-100 text-red-700'
          when 'high' then 'bg-orange-100 text-orange-700'
          when 'medium' then 'bg-yellow-100 text-yellow-700'
          else 'bg-blue-100 text-blue-700'
          end %>">
      <%= related_card.priority[0].upcase %>
    </span>
    <%= link_to related_card.title.truncate(40),
        board_card_path(board, related_card),
        class: "text-gray-700 hover:text-gray-900 hover:underline truncate",
        data: { turbo_frame: "_top" } %>
  </div>
  <% if board.user_can_edit?(current_user) %>
    <%
      # Find the relationship to delete
      relationship = if ['blocks', 'depends_on', 'related_to'].include?(relationship_type)
        card.outgoing_relationships.find_by(target_card: related_card, relationship_type: relationship_type)
      else
        # For inverse types, find the incoming relationship
        case relationship_type
        when 'blocked_by'
          card.incoming_relationships.find_by(source_card: related_card, relationship_type: 'blocks')
        when 'dependency_of'
          card.incoming_relationships.find_by(source_card: related_card, relationship_type: 'depends_on')
        end
      end
    %>
    <% if relationship %>
      <%= button_to board_card_card_relationship_path(board, relationship.source_card, relationship),
          method: :delete,
          class: "p-1 text-gray-400 hover:text-red-600 rounded transition-colors",
          data: { turbo_method: :delete, turbo_confirm: "Remove this relationship?" },
          title: "Remove relationship" do %>
        <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      <% end %>
    <% end %>
  <% end %>
</div>
