<div class="h-full flex flex-col">
  <!-- Header -->
  <div class="px-4 py-6 sm:px-6 border-b border-gray-200">
    <div class="flex items-start justify-between">
      <h2 class="text-lg font-semibold text-gray-900"><%= @card.title %></h2>
      <button type="button" data-action="drawer#close" class="text-gray-400 hover:text-gray-500">
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="mt-2 flex items-center gap-2">
      <%= render partial: 'shared/priority_badge', locals: { priority: @card.priority } %>
      <span class="text-sm text-gray-500">in <%= @card.column.name %></span>
    </div>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-y-auto px-4 py-6 sm:px-6">
    <% if @board.user_can_edit?(current_user) %>
      <%= form_with model: [@board, @card], class: "space-y-6" do |f| %>
        <div>
          <%= f.label :title, class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1">
            <%= f.text_field :title, class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border" %>
          </div>
        </div>

        <div>
          <%= f.label :description, class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1">
            <%= f.text_area :description, rows: 4, class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border" %>
          </div>
        </div>

        <div>
          <%= f.label :priority, class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1">
            <%= f.select :priority, Card::PRIORITIES.map { |p| [p.capitalize, p] }, {}, class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border" %>
          </div>
        </div>

        <div>
          <%= f.label :due_date, class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1">
            <%= f.date_field :due_date, class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border" %>
          </div>
        </div>

        <div>
          <%= f.label :column_id, "Column", class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1">
            <%= f.select :column_id, @board.columns.map { |c| [c.name, c.id] }, {}, class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border" %>
          </div>
        </div>

        <div class="flex gap-2">
          <%= f.submit "Save Changes", class: "flex-1 rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 cursor-pointer" %>
        </div>
      <% end %>
    <% else %>
      <div class="space-y-4">
        <div>
          <h4 class="text-sm font-medium text-gray-500">Description</h4>
          <p class="mt-1 text-sm text-gray-900"><%= @card.description.presence || "No description" %></p>
        </div>

        <div>
          <h4 class="text-sm font-medium text-gray-500">Due Date</h4>
          <p class="mt-1 text-sm text-gray-900"><%= @card.due_date&.strftime("%B %d, %Y") || "No due date" %></p>
        </div>
      </div>
    <% end %>

    <!-- Assignees Section -->
    <div class="mt-8 border-t border-gray-200 pt-6">
      <h4 class="text-sm font-medium text-gray-700">Assignees</h4>
      <div class="mt-2 space-y-2">
        <% if @card.assignees.any? %>
          <% @card.assignees.each do |assignee| %>
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <div class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white text-sm font-medium">
                  <%= assignee.initials %>
                </div>
                <span class="text-sm text-gray-900"><%= assignee.name %></span>
              </div>
              <% if @board.user_can_edit?(current_user) %>
                <%= button_to unassign_board_card_path(@board, @card, user_id: assignee.id), method: :delete, class: "text-gray-400 hover:text-red-500" do %>
                  <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                <% end %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p class="text-sm text-gray-500">No assignees</p>
        <% end %>
      </div>
    </div>

    <!-- Metadata -->
    <div class="mt-8 border-t border-gray-200 pt-6">
      <dl class="space-y-2 text-sm">
        <div class="flex justify-between">
          <dt class="text-gray-500">Created</dt>
          <dd class="text-gray-900"><%= @card.created_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-gray-500">Updated</dt>
          <dd class="text-gray-900"><%= @card.updated_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
        </div>
        <div class="flex justify-between">
          <dt class="text-gray-500">Created by</dt>
          <dd class="text-gray-900"><%= @card.created_by.name %></dd>
        </div>
      </dl>
    </div>
  </div>

  <!-- Footer -->
  <% if @board.user_can_edit?(current_user) %>
    <div class="border-t border-gray-200 px-4 py-4 sm:px-6">
      <%= button_to board_card_path(@board, @card), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this card?" }, class: "w-full rounded-md bg-red-50 px-3 py-2 text-sm font-semibold text-red-600 hover:bg-red-100" do %>
        Delete Card
      <% end %>
    </div>
  <% end %>
</div>
